shadow$provide.module$node_modules$dagre$lib$position$bk=function(global,require,module,exports){function findType1Conflicts(g,layering){var conflicts={};_.reduce(layering,function(prevLayer,layer){var k0=0,scanPos=0,prevLayerLength=prevLayer.length,lastNode=_.last(layer);_.forEach(layer,function(v,i){var w=findOtherInnerSegmentNode(g,v),k1=w?g.node(w).order:prevLayerLength;if(w||v===lastNode)_.forEach(layer.slice(scanPos,i+1),function(scanNode){_.forEach(g.predecessors(scanNode),function(u){var uLabel=
g.node(u),uPos=uLabel.order;!(uPos<k0||k1<uPos)||uLabel.dummy&&g.node(scanNode).dummy||addConflict(conflicts,u,scanNode)})}),scanPos=i+1,k0=k1});return layer});return conflicts}function findType2Conflicts(g,layering){function scan(south,southPos,southEnd,prevNorthBorder,nextNorthBorder){var v;_.forEach(_.range(southPos,southEnd),function(i){v=south[i];g.node(v).dummy&&_.forEach(g.predecessors(v),function(u){var uNode=g.node(u);uNode.dummy&&(uNode.order<prevNorthBorder||uNode.order>nextNorthBorder)&&
addConflict(conflicts,u,v)})})}var conflicts={};_.reduce(layering,function(north,south){var prevNorthPos=-1,nextNorthPos,southPos=0;_.forEach(south,function(v,southLookahead){"border"===g.node(v).dummy&&(v=g.predecessors(v),v.length&&(nextNorthPos=g.node(v[0]).order,scan(south,southPos,southLookahead,prevNorthPos,nextNorthPos),southPos=southLookahead,prevNorthPos=nextNorthPos));scan(south,southPos,south.length,nextNorthPos,north.length)});return south});return conflicts}function findOtherInnerSegmentNode(g,
v){if(g.node(v).dummy)return _.find(g.predecessors(v),function(u){return g.node(u).dummy})}function addConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp}(tmp=conflicts[v])||(conflicts[v]=tmp={});tmp[w]=!0}function hasConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp}return _.has(conflicts[v],w)}function verticalAlignment(g,layering,conflicts,neighborFn){var root={},align={},pos={};_.forEach(layering,function(layer){_.forEach(layer,function(v,order){root[v]=v;align[v]=v;pos[v]=order})});_.forEach(layering,
function(layer){var prevIdx=-1;_.forEach(layer,function(v){var ws=neighborFn(v);if(ws.length){ws=_.sortBy(ws,function(w){return pos[w]});var mp=(ws.length-1)/2,i=Math.floor(mp);for(mp=Math.ceil(mp);i<=mp;++i){var w$jscomp$0=ws[i];align[v]===v&&prevIdx<pos[w$jscomp$0]&&!hasConflict(conflicts,v,w$jscomp$0)&&(align[w$jscomp$0]=v,align[v]=root[v]=root[w$jscomp$0],prevIdx=pos[w$jscomp$0])}}})});return{root,align}}function horizontalCompaction(g,layering,root,align,reverseSep){function iterate(setXsFunc,
nextNodesFunc){for(var stack=blockG.nodes(),elem=stack.pop(),visited={};elem;)visited[elem]?setXsFunc(elem):(visited[elem]=!0,stack.push(elem),stack=stack.concat(nextNodesFunc(elem))),elem=stack.pop()}var xs={},blockG=buildBlockGraph(g,layering,root,reverseSep),borderType=reverseSep?"borderLeft":"borderRight";iterate(function(elem){xs[elem]=blockG.inEdges(elem).reduce(function(acc,e){return Math.max(acc,xs[e.v]+blockG.edge(e))},0)},blockG.predecessors.bind(blockG));iterate(function(elem){var min=
blockG.outEdges(elem).reduce(function(acc,e){return Math.min(acc,xs[e.w]-blockG.edge(e))},Number.POSITIVE_INFINITY),node=g.node(elem);min!==Number.POSITIVE_INFINITY&&node.borderType!==borderType&&(xs[elem]=Math.max(xs[elem],min))},blockG.successors.bind(blockG));_.forEach(align,function(v){xs[v]=xs[root[v]]});return xs}function buildBlockGraph(g,layering,root,reverseSep){var blockGraph=new Graph,graphLabel=g.graph(),sepFn=sep(graphLabel.nodesep,graphLabel.edgesep,reverseSep);_.forEach(layering,function(layer){var u;
_.forEach(layer,function(v){var vRoot=root[v];blockGraph.setNode(vRoot);if(u){var uRoot=root[u],prevMax=blockGraph.edge(uRoot,vRoot);blockGraph.setEdge(uRoot,vRoot,Math.max(sepFn(g,v,u),prevMax||0))}u=v})});return blockGraph}function findSmallestWidthAlignment(g,xss){return _.minBy(_.values(xss),function(xs){var max=Number.NEGATIVE_INFINITY,min=Number.POSITIVE_INFINITY;_.forIn(xs,function(x,v){v=g.node(v).width/2;max=Math.max(x+v,max);min=Math.min(x-v,min)});return max-min})}function alignCoordinates(xss,
alignTo){var alignToVals=_.values(alignTo),alignToMin=_.min(alignToVals),alignToMax=_.max(alignToVals);_.forEach(["u","d"],function(vert){_.forEach(["l","r"],function(horiz){var alignment=vert+horiz,xs=xss[alignment],delta;if(xs!==alignTo){var xsVals=_.values(xs);(delta="l"===horiz?alignToMin-_.min(xsVals):alignToMax-_.max(xsVals))&&(xss[alignment]=_.mapValues(xs,function(x){return x+delta}))}})})}function balance(xss,align){return _.mapValues(xss.ul,function(ignore,v){if(align)return xss[align.toLowerCase()][v];
ignore=_.sortBy(_.map(xss,v));return(ignore[1]+ignore[2])/2})}function sep(nodeSep,edgeSep,reverseSep){return function(g,v,w){v=g.node(v);g=g.node(w);w=v.width/2;if(_.has(v,"labelpos"))switch(v.labelpos.toLowerCase()){case "l":var delta=-v.width/2;break;case "r":delta=v.width/2}delta&&(w+=reverseSep?delta:-delta);delta=0;w+=(v.dummy?edgeSep:nodeSep)/2;w+=(g.dummy?edgeSep:nodeSep)/2;w+=g.width/2;if(_.has(g,"labelpos"))switch(g.labelpos.toLowerCase()){case "l":delta=g.width/2;break;case "r":delta=-g.width/
2}delta&&(w+=reverseSep?delta:-delta);return w}}var _=require("module$node_modules$dagre$lib$lodash"),Graph=require("module$node_modules$dagre$lib$graphlib").Graph,util=require("module$node_modules$dagre$lib$util");module.exports={positionX:function(g){var layering=util.buildLayerMatrix(g),conflicts=_.merge(findType1Conflicts(g,layering),findType2Conflicts(g,layering)),xss={},adjustedLayering;_.forEach(["u","d"],function(vert){adjustedLayering="u"===vert?layering:_.values(layering).reverse();_.forEach(["l",
"r"],function(horiz){"r"===horiz&&(adjustedLayering=_.map(adjustedLayering,function(inner){return _.values(inner).reverse()}));var neighborFn=("u"===vert?g.predecessors:g.successors).bind(g);neighborFn=verticalAlignment(g,adjustedLayering,conflicts,neighborFn);neighborFn=horizontalCompaction(g,adjustedLayering,neighborFn.root,neighborFn.align,"r"===horiz);"r"===horiz&&(neighborFn=_.mapValues(neighborFn,function(x){return-x}));xss[vert+horiz]=neighborFn})});var smallestWidth=findSmallestWidthAlignment(g,
xss);alignCoordinates(xss,smallestWidth);return balance(xss,g.graph().align)},findType1Conflicts,findType2Conflicts,addConflict,hasConflict,verticalAlignment,horizontalCompaction,alignCoordinates,findSmallestWidthAlignment,balance}}
//# sourceMappingURL=module$node_modules$dagre$lib$position$bk.js.map
